# Gitnote UI/UX改善 引き継ぎ資料
**作業日**: 2026-01-13
**作業者**: Claude (AI Assistant)
**引き継ぎ先**: 新規開発メンバー

---

## 📋 目次
1. [プロジェクト概要](#プロジェクト概要)
2. [実装した改善内容](#実装した改善内容)
3. [ファイル構成と変更箇所](#ファイル構成と変更箇所)
4. [開発環境のセットアップ](#開発環境のセットアップ)
5. [動作確認手順](#動作確認手順)
6. [今後の課題](#今後の課題)
7. [参考資料](#参考資料)

---

## プロジェクト概要

### Gitnoteとは
Gitnote は、Markdown エディタと Git リポジトリを連携させたノート管理アプリケーションです。

**技術スタック**:
- **フレームワーク**: Next.js 16.1.1 (App Router + Turbopack)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS v4
- **エディタ**: TipTap (React)
- **認証**: NextAuth.js
- **データベース**: Supabase
- **Git連携**: GitHub API (Octokit)
- **ローカルDB**: Dexie.js (IndexedDB)

**プロジェクトパス**: `Y:\Apps\Gitnote\app`

---

## 実装した改善内容

前任者からの引き継ぎ資料を基に、以下の重要改善を実装し、MVPを完成させました。

### ✅ 優先度高（アーキテクチャ刷新）

#### 1. ID-First Architecture の導入
**課題**: ノート作成が「Gitパス」に依存しており、ファイル名未定時のドラフト保存や移動が不安定だった。

**実装内容**:
- ノート作成時に即座にUUIDを発行（`create-draft` API）。
- メタデータ（タイトル、タグ、パス）とコンテンツを分離して管理。
- **効果**: 「New Note」を押した瞬間に書き始められ、ファイル名は後から自動決定される"Stress-Free"な体験を実現。

#### 2. データ保護 (IndexedDB + Dexie.js)
**課題**: ネットワーク不安定時に編集内容が失われるリスクがあった。

**実装内容**:
- `Dexie.js` を導入し、エディタへの入力内容を **1秒ごとにIndexedDBへ自動保存**。
- GitHub同期（30秒ごと）が失敗してもローカルデータは安全に保持。
- ページリロード時にIndexedDBから最新内容を自動復元。

#### 3. ライブラリ機能の強化（ファイル管理）
**課題**: ノートの整理（移動・削除）を一括で行う手段がなかった。

**実装内容**:
- **選択モード**: 長押し/右クリックで複数選択が可能。
- **アクションバー**: 
  - **削除**: DBとGitHubから一括削除。
  - **移動**: フォルダ階層を維持したまま移動。
  - **ラベル**: ラベルの一括付与・解除。

### ✅ エッジケース対応

#### 4. 堅牢性の向上
- **移動時の同名ファイル検知**: 移動先に同名ファイルがある場合、上書き防止のため処理をスキップ。
- **削除済みノートのハンドリング**: ローカル履歴に残っているノートが削除されていた場合、自動的に新規ドラフト画面へリセット。
- **コンフリクト検知**: 編集競合時にアラートを表示（`SyncStatusIcon`が赤色に変化）。

---

## ファイル構成と変更箇所

### 新規作成・主要変更ファイル

1.  **データ層**:
    *   `app/src/lib/local-db.ts`: IndexedDB (Dexie) ラッパー
    *   `app/src/lib/api-error.ts`: 統一エラーハンドリング

2.  **API層**:
    *   `app/src/app/api/notes/create-draft/route.ts`: ID-Firstドラフト作成
    *   `app/src/app/api/notes/batch/*`: 一括操作用エンドポイント群

3.  **UI層**:
    *   `app/src/app/editor/EditorContent.tsx`: エディタロジックの完全刷新（同期・保存・復元）
    *   `app/src/app/library/page.tsx`: 選択モード・アクションバー実装

---

## 開発環境のセットアップ

### 前提条件
- Node.js: v18以上推奨
- npm: v9以上
- Git: バージョン管理用

### セットアップ手順

#### 1. 依存関係のインストール
```bash
cd Y:\Apps\Gitnote\app
npm install
```

**新規追加パッケージ**:
- `dexie`: IndexedDBラッパー
- `@ducanh2912/next-pwa`: PWA対応

#### 2. 環境変数の設定
`.env.local`を確認（既存環境を利用）。

#### 3. 開発サーバーの起動
```cmd
cd Y:\Apps\Gitnote\app
npm run dev
```
起動後: http://localhost:3000

---

## 動作確認手順

### 1. エディタ基本動作
1.  **新規作成**: Library右上の「New Note」をクリック。即座にエディタが開く。
2.  **オフライン保存**: ネットワークを切断し、適当に入力。リロードしても内容が残っていることを確認。
3.  **同期**: ネットワーク復帰後、「Sync Now」ボタンまたは30秒待機で緑チェック（Synced）になることを確認。

### 2. ライブラリ一括操作
1.  `/library` でノートを右クリックし選択モードへ。
2.  複数選択し、上部のアクションバーから「移動」や「削除」を実行。
3.  画面がリフレッシュされ、GitHub上でもファイルが移動/削除されていることを確認。

---

## 今後の課題 (Gap Analysis)

### 🔴 Phase 3（必須対応）

1.  **オフライン新規作成**
    *   現状: サーバーサイドID発行のため、完全オフラインでは新規作成不可。
    *   対策: クライアントサイドUUID生成への移行。

2.  **コンフリクト解決UI**
    *   現状: エラー表示のみ。
    *   対策: 「強制上書き」「別名保存」の実装。

3.  **エラーハンドリング適用**
    *   `api-error.ts` を全APIコール箇所に適用する。

### 🟡 Phase 4（機能拡張）

1.  **全文検索**: Postgres Full Text Searchの導入。
2.  **画像アップロード**: GitHubへの画像保存フロー最適化。

---

## 連絡先・質問先

不明点があればプロジェクトリードまでお問い合わせください。
詳しい仕様は `Plan/plan.md` を参照してください。

新規参加メンバーが最初に確認すべき項目:

- [ ] プロジェクトをクローン/確認: `Y:\Apps\Gitnote`
- [ ] 依存関係をインストール: `npm install`
- [ ] `.env.local`ファイルの存在確認
- [ ] 開発サーバーが起動できるか: `npm run dev`
- [ ] ビルドが成功するか: `npm run build`
- [ ] `/editor`で保存状態表示が動作するか
- [ ] `/editor`で`?`キーでモーダルが表示されるか
- [ ] `/library`でソート機能が動作するか
- [ ] `/settings`でダークモード切替ができるか
- [ ] Git履歴を確認: `git log`
- [ ] 本ドキュメントを最後まで読んだ

---

## 変更履歴

| 日付 | 作業者 | 変更内容 |
|------|--------|---------|
| 2026-01-13 | Claude | 初版作成（UI/UX改善9項目実装） |
| 2026-01-14 | （引き継ぎ先） | （今後の変更を記録） |

---

**以上、引き継ぎ資料です。不明点があれば担当者にお問い合わせください。**
